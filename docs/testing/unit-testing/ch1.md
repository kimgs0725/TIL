---
sidebar_position: 1
---
# 1. 단위 테스트의 목표
- 단위 테스트에 시간을 투자할 때는 테스트에 드는 노력을 가능한 줄이고, 그에 따른 이득을 최대화 해야함
- 여기서 어떤 ㅇ단위 테스트 기술이 좋은지를 구별하는데 도움이 될 것
- 특정 상황에서 적절한 테스트 기술을 적용하고, 공통적인 안티 패턴(Anti Pattern)을 피하는 방법을 배움

## 1. 단위 테스트 현황
- 이제 대부분 소프트웨어에 단위테스트는 필수
- 테스트를 해도 개발자가 원하는 결과를 얻지 못하는 경우가 많음
  - 도움이 될 거라고 했던 단위 테스트는 오히려 상황을 악화시킬 수 있음
- 이 책에선 단위 테스트를 시작할 때 많은 도움을 줌

## 2. 단위 테스트 목표
- 소프트웨어 프로젝트의 지속 가능한 성장을 가능하게 하는 것
- 테스트가 없는 일반 프로젝트는 초반 작업 소요 시간은 빠르지만, 프로젝트 진행도가 길어질수록 기하급수적으로 작업시간이 증가함
- 반면 테스트가 있는 프로젝트는 초반 작업 소요 시간은 느리지만, 프로젝트 진행도가 길어짐에도 일정한 작업 소요 시간이 걸리게 됨

![image](https://user-images.githubusercontent.com/4207192/163184420-c1c7f4cf-c6cc-46c3-a824-370ee3afb5dd.png)

- 지속적인 정리와 리팩토링이 없으면 시스템은 점점 더 복잡
  - 소프트웨어 엔트로피(무질서)가 증가
- 테스트는 안전망 역할을 하고 회귀에 대한 보험을 제공하는 도구
  - 회귀: 특정 사건(ex. 코드 수정) 후에 기능이 의도한대로 동작하지 않는 경우. 소프트웨어 버그라고 부르기도 함

#### 좋은 테스트와 좋지 않은 테스트를 가르는 요인
- 잘못 작성된 테스트도 초반에 코드가 나빠지는 것을 늦출 수 있음
- 프로젝트 침체 단계에 진입하는 걸 조금 늦출 뿐

![image](https://user-images.githubusercontent.com/4207192/163541045-1d6c300d-c5c8-4909-87ca-44cca54a9aba.png)

- 테스트의 가치와 유지 비용을 모두 고려
  - 기반 코드를 리팩토링 시 테스트도 리팩토링
  - 각 코드 변경 시 테스트 실행
  - 테스트가 잘못된 경고를 발생시킬 경우 처리
  - 기반 코드가 어떻게 동작하는지 이해하려고 할 때에는 테스트를 읽는 데 시간을 투자

## 3. 테스트 스위트 품질 측정을 위한 커버리지 지표
- 커버리지 지표: 테스트 스위트가 소스코드를 얼마나 실행했는지를 백분율로 표시
- 코드 커버리지가 너무 적다는 것은 테스트가 충분치 않다는 증거
- 하지만 커버리지가 높다고 양질의 테스트 스위트라고 보장 x

#### 코드 커버리지 지표에 대한 이해
> 코드 커버리지(테스트 커버리지) = 실행 코드 라인 수 / 전체 라인 수

- 개발자가 어떻게 개발하냐에 따라 커버리지 숫자를 가지고 장난칠 수 있음
  ```java
  public boolean isString(String input) {
    if (input.length > 5) {
      return true;
    }
    return false
  }
  
  public void test() {
    boolean result = isString("abc")
    assertThat(result).isFalse()
  }
  ```
- 위 코드의 커버리지는 80%이다(4/5 = 0.8 => 80%)
- 근데 `isString`을 리팩토링을 통해 커버리지를 100%로 맞출 수 있음
  ```java
  public boolean isString(String input) {
    return input.length > 5
  }
  
  public void test() {
    boolean result = isString("abc")
    assertThat(result).isFalse()
  }
  ```
- 한 줄만 검사하기 때문에 코드 커버리지는 100%
- 하지만 테스트 코드는 변하지 않음
- 라인 수만 처리하기 때문에 코드를 더 작게 해도 코드베이스의 유지 보수성은 변하지 않음

#### 분기 커버리지 지표에 대한 이해
- if문, switch문과 같은 제어 구조에 중점
- 테스트 스위트 내 테스트가 통과하는 제어 구조의 수를 나타냄

> 분기 커버리지 = 통과 분기 / 전체 분기 수

```java
public boolean isString(String input) {
  return input.length > 5
}

public void test() {
  boolean result = isString("abc")
  assertThat(result).isFalse()
}
```
- 위 테스트 케이스에선 false인 경우만 테스트함
- 그래서 분기 커버리지는 50%임

#### 특정 커버리지 숫자를 목표로 하기
- 커버리지 지표만으로 충분하지 않음
  - 지표는 단지 지표로서만 봐야함
- 하지만, 코드 커버리지를 측정하는 것은 품질있는 테스트 스위트로 가는 첫걸음

## 4. 무엇이 성공적인 테스트 스위트를 만드는가?

- 성공적인 테스트 스위트는 다음과 같은 특성을 지님
  - 개빌 주기에 통합되어 있음
  - 코드베이스에서 가장 중요한 부분만을 대상으로 함
  - 최소한의 유지비로 최대의 가치를 끌어냄

#### 개발 주기에 통합되어 있음
- 모든 테스트는 개발 주기에 통합
- 코드가 변경될 때마다, 테스트는 실행해야 함

#### 코드베이스에서 가장 중요한 부분만을 대상으로 함
- 중요한 부분에 단위테스트, 다른 부분은 간접적으로 검증
- 다른부분은 다음과 같음
  - 인프라 코드
  - DB나 서드파티 시스템과 같은 외부 종속성
  - 모든 것을 하나로 묶는 코드
- 이를 위해서 도메인 모델과 아닌 부분을 나누도록 노력해야함

#### 최소 유지비로 최대 가치를 끌어냄
- 위 목표를 달성하기 위한 속성은 다음과 같음
  - 가치있는 테스트 식별하기
  - 가치있는 테스트 작성하기
- 가치있는 테스트를 작성하려면 코드 설계 기술을 알아야 함

## 책을 통해 배우는 것
- 제품 코드와 관련 테스트 스위트를 리팩토링하는 방법
- 단위 테스트를 다양한 스타일로 적용하는 방법
- 통합 테스트로 시스템 전체 동작 검증하기
- 단위 테스트 안티패턴 식별하고 예방하기
